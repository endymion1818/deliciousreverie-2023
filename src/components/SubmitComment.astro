---
const { slug } = Astro.props;

---
<script is:inline>
  function respondToCommentSubmission(isSuccessful) {
    const formContainer = document.getElementById('form-container');
    // ahh HTML templates. What joy.
    /**
     * @type {HTMLTemplateElement}
     */
      const submissionSuccessTemplate = document.querySelector(
    'template[name="submission-success"]'
    );
    /**
     * @type {HTMLTemplateElement}
     */
    const submissionFailureTemplate = document.querySelector(
    'template[name="submission-failure"]'
    );

    const template = isSuccessful
        ? submissionSuccessTemplate?.content.cloneNode(true)
        : submissionFailureTemplate?.content.cloneNode(true);

    formContainer?.appendChild(template);
  }
  const form = document.getElementById('contact-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(form);
    const body = JSON.stringify(Object.fromEntries(data))
    
    try {
      const response = await fetch('/.netlify/functions/send-comment', {
        method: 'POST',
        body,
        headers: {
          'content-type': 'application/json',
        },
      });
      if (response.ok) {
        respondToCommentSubmission(true)
        return;
      }
      respondToCommentSubmission(false)
    } catch (error) {
      respondToCommentSubmission(false)
    }
  });
</script>
<div id="form-container">
  <form 
    id="contact-form" 
    method="POST" 
    class="flex flex-col"
  >
    <input
      required
      type="text"
      name="name"
      id="name"
      placeholder="name"
      class="w-full max-w-xs mb-2 input"
      max="100"
    />
    <input
      required
      type="email"
      name="email"
      id="email"
      placeholder="email"
      class="w-full max-w-xs mb-2 input"
      max="100"
    />
    <textarea id="body" placeholder="Message" name="body" rows="3" class="w-full max-w-xs mb-2 textarea" maxlength="500" 
    ></textarea>
    <input type="hidden" name="slug" value={slug} />
    <br/>
    <input type="submit" class="w-full max-w-xs btn btn-primary" value="Send message" />
  </form>
   <template name="submission-success">
    <div class="mt-4 alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-6 h-6 stroke-current shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <div>
          <h1 class="text-lg">Awesome.</h1>
          <p class="mb-2">Thanks for submitting a comment!</p>
          <p class="mb-2">I will approve it in the next few days.</p>
          <p class="mb-2">Have you considered subscribing to my RSS feed?</p>
        </div>
    </div>
    </template>
    <template name="submission-failure">
    <div class="mt-4 alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="w-6 h-6 stroke-current shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 
        <div>
          <h1 class="text-4xl">Drat.</h1>
          <p class="text-lg">
            Sorry, something went wrong when we tried to submit your request. Please try again later.
          </p>
        </div>
    </div>
  </template>
</div>
